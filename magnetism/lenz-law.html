<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Lenz's Law: Magnet & Coil</title>
<style>
  body { margin:0; overflow:hidden; background:#071017; font-family:Segoe UI,sans-serif; }
  #controls {
    position:absolute; top:10px; left:10px; background:rgba(0,0,0,0.5);
    padding:12px; border-radius:10px; backdrop-filter:blur(6px); color:#fff;
  }
  input[type=range] { width:200px; }
</style>
</head>
<body>
<div id="controls">
  <h3>Lenz's Law Demo</h3>
  <label>Magnet Position: <span id="magPos">0</span></label><br>
  <input type="range" id="magSlider" min="-3" max="3" step="0.01" value="0"><br><br>
  <label><input type="checkbox" id="autoMove"> Auto Move Magnet</label>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script>
let scene = new THREE.Scene();
let camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight,0.1,100);
let renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Lights
const light = new THREE.PointLight(0xffffff,1.5); light.position.set(5,5,5); scene.add(light);
const ambient = new THREE.AmbientLight(0x404040); scene.add(ambient);

// Coil (copper)
function createCoil(radius=0.7, turns=10, length=2){
  const curve = new THREE.Curve();
  curve.getPoint = t => {
    const angle = t * Math.PI*2*turns;
    const x = radius*Math.cos(angle);
    const y = radius*Math.sin(angle);
    const z = length*(t-0.5);
    return new THREE.Vector3(x,y,z);
  };
  const geo = new THREE.TubeGeometry(curve, 400, 0.05, 12,false);
  const mat = new THREE.MeshStandardMaterial({color:0xff9900, metalness:0.7, roughness:0.2});
  return new THREE.Mesh(geo, mat);
}
const coil = createCoil();
scene.add(coil);

// Bar magnet
const magnet = new THREE.Mesh(
  new THREE.BoxGeometry(0.4,0.4,1.2),
  new THREE.MeshStandardMaterial({color:0xff5555})
);
scene.add(magnet);
const magnetS = new THREE.Mesh(
  new THREE.BoxGeometry(0.2,0.4,0.6),
  new THREE.MeshStandardMaterial({color:0x2266ff})
);
magnetS.position.z = -0.3; magnet.add(magnetS);

// Magnetic field lines along magnet axis
const fieldGroup = new THREE.Group();
for(let i=0;i<12;i++){
  const curve = new THREE.CatmullRomCurve3([
    new THREE.Vector3(i*0.05-0.3,0,-1),
    new THREE.Vector3(0,0,i*0.1-0.5),
    new THREE.Vector3(i*0.05-0.3,0,1)
  ]);
  const geo = new THREE.TubeGeometry(curve,20,0.01,8,false);
  const mat = new THREE.MeshBasicMaterial({color:0x44ccff});
  const line = new THREE.Mesh(geo,mat);
  fieldGroup.add(line);
}
scene.add(fieldGroup);

// Arrows showing induced current in coil (opposing flux)
const arrows = [];
for(let i=-4;i<=4;i++){
  const arrow = new THREE.ArrowHelper(new THREE.Vector3(0,1,0), new THREE.Vector3(0.5,0,i*0.3),0.5,0xffff00);
  scene.add(arrow);
  arrows.push(arrow);
}

// Bulb connected to coil
const bulb = new THREE.Mesh(
  new THREE.SphereGeometry(0.2,16,16),
  new THREE.MeshStandardMaterial({color:0xffffee, emissive:0x000000})
);
bulb.position.set(1.5,0,0);
scene.add(bulb);

// Camera
camera.position.set(4,3,2); camera.lookAt(0,0,0);

// Controls
const slider = document.getElementById("magSlider");
let autoMove=false;
document.getElementById("autoMove").addEventListener("change", e=>autoMove=e.target.checked);

// Animation vars
let time=0;
let lastFlux=0;

function animate(){
  requestAnimationFrame(animate);
  time+=0.03;

  // Magnet movement
  if(autoMove){
    magnet.position.z = Math.sin(time)*2;
    slider.value = magnet.position.z;
  } else magnet.position.z = parseFloat(slider.value);
  document.getElementById("magPos").innerText = magnet.position.z.toFixed(2);

  // Approx magnetic flux through coil (primary along z)
  const dist = magnet.position.z; // flux proportional to distance along axis
  const flux = 1/(dist*dist+0.1);
  const inducedEMF = -(flux-lastFlux)/0.03; // Lenz: oppose change
  lastFlux = flux;

  // Bulb glow proportional to induced EMF
  const glow = Math.min(1, Math.abs(inducedEMF));
  bulb.material.emissiveIntensity = glow;
  bulb.material.emissive.setHex(0xffff00);

  // Arrows direction in coil (opposing flux)
  const dir = Math.sign(inducedEMF)||1;
  arrows.forEach(a=>{
    a.setDirection(new THREE.Vector3(0,dir,0));
  });

  // Field lines move slightly with magnet
  fieldGroup.position.z = magnet.position.z;

  renderer.render(scene,camera);
}

animate();

// Resize
window.addEventListener("resize", ()=>{
  camera.aspect=window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
